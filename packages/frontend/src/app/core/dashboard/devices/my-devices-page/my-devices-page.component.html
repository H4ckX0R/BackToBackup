<main class="h-screen flex flex-col">
  <app-navbar></app-navbar>
  <div class="flex h-full">
    <section class="lg:w-1/4 md:w-1/3 w-full pt-2 ps-2 h-full">
      <div class="flex items-center justify-between pb-2">
        <h1 class="text-2xl font-semibold ">Mis dispositivos</h1>
        <button pButton type="button" (click)="openAdd()" severity="success">
          <ng-icon name="bootstrapWindowPlus" size="20"></ng-icon> <span class="font-semibold">Añadir</span>
        </button>
      </div>
      <p-listbox [options]="devices" [(ngModel)]="selectedDevice" optionLabel="name" [filter]="true" class="w-full"
        scrollHeight="calc(100vh - 220px)" scrollable="true">
        <ng-template pTemplate="item" let-device>
          <div class="flex items-center justify-between gap-2 w-full">
            <span>{{ device.name }}</span>
          </div>
        </ng-template>
      </p-listbox>
    </section>
    <p-divider layout="vertical" styleClass="mx-2"></p-divider>
    <section class="lg:w-3/4 md:w-3/4 w-full">
      @if (selectedDevice && explorerOpen) {
      <app-file-explorer [device]="selectedDevice"></app-file-explorer>
      } @else if (selectedDevice) {
      <div class="mt-2 me-2">
        <p-card>
          <ng-template #header>
            <div class="flex items-center justify-between px-6 pt-6">
              <h2 class="text-2xl font-semibold whitespace-nowrap">{{ selectedDevice.name }}</h2>
              <div class="flex justify-start w-full ms-4">
                <p-badge [value]="selectedDevice.online ? 'Online' : 'Offline'"
                  [severity]="selectedDevice.online ? 'success' : 'danger'">
                </p-badge>
              </div>
              <p-button type="button" variant="text" severity="secondary">
                <ng-icon name="bootstrapThreeDots" size="20"></ng-icon>
              </p-button>
            </div>
          </ng-template>
          <ng-template #subtitle>
            <div class="flex items-center justify-between">
              <p class="w-full">Hostname: {{ selectedDevice.hostname }}</p>
              <p class="w-full">OS: {{ selectedDevice.os }}</p>
            </div>
          </ng-template>
          <ng-template #content>

          </ng-template>
          <ng-template #footer>
            <div class="flex gap-4 mt-1">
              <p-button label="Explorador de Archivos" severity="info" class="w-full"
                [disabled]="!selectedDevice.online" (click)="openExplorer()">
                <ng-template pTemplate="icon">
                  <ng-icon name="bootstrapFolder" size="20"></ng-icon>
                </ng-template>
              </p-button>
            </div>
          </ng-template>
        </p-card>
      </div>
      } @else {
      <div class="flex items-center justify-center h-full">
        <p>No hay dispositivo seleccionado</p>
      </div>
      }
    </section>
  </div>
</main>

























<p-dialog header="Nuevo dispositivo" [(visible)]="showAddDialog" styleClass="m-5 w-full md:w-1/2 lg:w-1/3"
  [modal]="true" [draggable]="false" [dismissableMask]="true" resizable="false" blockScroll="true">

  <ng-template #content styleClass="overflow-y-visible">
    <form class="flex flex-col gap-2 overflow-y-visible" [formGroup]="newDeviceForm">
      <div>
        <label>Nombre</label>
        <input type="text" pInputText class="w-full" variant="filled" formControlName="name" />
      </div>
    </form>
  </ng-template>

  <ng-template #footer>
    <div class="flex justify-end gap-2 w-full">
      <p-button label="Generar Token de Registro" severity="success" (onClick)="addDevice()"
        [disabled]="newDeviceForm.invalid">
        <ng-template pTemplate="icon">
          <ng-icon name="bootstrapWindowPlus" size="20"></ng-icon>
        </ng-template>
      </p-button>
    </div>
  </ng-template>

  <ng-template #closeicon>
    <ng-icon name="bootstrapXLg" size="20" class="mt-1.5"></ng-icon>
  </ng-template>
</p-dialog>

<p-dialog header="Token de Registro" [(visible)]="showTokenDialog" styleClass="m-5 w-full md:w-1/2 lg:w-1/3"
  [modal]="true" [draggable]="false" [dismissableMask]="false" resizable="false" blockScroll="true">

  <ng-template #content styleClass="overflow-y-visible">
    <form class="flex flex-col gap-2 overflow-y-visible">
      <div>
        <label>Token</label>
        <input type="text" pInputText class="w-full" variant="filled" [value]="registerTokenDialog" readonly />
      </div>
      <p-message severity="error">Este token es único para el dispositivo y se perderá una vez cerrado este
        mensaje</p-message>
    </form>
  </ng-template>
  <ng-template #closeicon>
    <ng-icon name="bootstrapXLg" size="20" class="mt-1.5"></ng-icon>
  </ng-template>
</p-dialog>